import React, { useEffect, useState } from "react";
import Navbar from "../components/Navbar";
import styled from "styled-components";
import { useTheme } from "styled-components";
import {
  PieChart, Pie, Cell, Tooltip, Legend, ResponsiveContainer
} from "recharts";
import { collection, getDocs } from "firebase/firestore";
import { db } from "../firebaseConfig";

const Container = styled.div`
  padding: 20px;
  background: ${({ theme }) => theme.colors.background};
  color: ${({ theme }) => theme.colors.text};
  min-height: 100vh;
`;

export default function MalwareEvaluation() {
  const [logs, setLogs] = useState([]);
  const theme = useTheme();

  useEffect(() => {
    getDocs(collection(db, "predictions"))
      .then((snap) => setLogs(snap.docs.map((d) => d.data())))
      .catch(console.error);
  }, []);

  // Evaluate true/false positive rates, etc. (stub data here)
  const evalData = [
    { name: "True Positives", value: logs.filter(l => l.label === "malware").length },
    { name: "True Negatives", value: logs.filter(l => l.label === "benign").length },
  ];
  const COLORS = [theme.colors.danger, theme.colors.success];

  return (
    <>
      <Navbar />
      <Container>
        <h1>Malware Evaluation</h1>
        <p>Overview of detection performance metrics.</p>
        <ResponsiveContainer width="100%" height={300}>
          <PieChart>
            <Pie
              data={evalData}
              dataKey="value"
              nameKey="name"
              outerRadius={80}
              label
            >
              {evalData.map((_, i) => (
                <Cell key={i} fill={COLORS[i]} />
              ))}
            </Pie>
            <Legend />
            <Tooltip />
          </PieChart>
        </ResponsiveContainer>
      </Container>
    </>
  );
}
